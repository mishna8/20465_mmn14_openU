
מטלת מנחה 14 - פרוייקט גמר
מעבדה בתכנות מערכות 20465 סמסטר א2021
מגישה : מיכל - , ת"ז --, 
קבוצה 82 , מנחה גזמאווי שאדי 
/*---------------------------------------------*/

הקבצים המוגשים: assembler - קובץ הרצה מקומפל 
main.c , definitions.h , code.c , code.h , data.c, data.h , outputToFiles.c , outputToFiles.h , symbolTable.c , symbolTable.h , pass1.c , pass1.h , pass2.c , pass2.h
makefile 
קבצי הרצה לדוגמא - ps - קובץ הדוגמא מחוברת הקורס , prog קובץ שמטרתו לעבוד כשורה , wrong קובץ עם שגיאות 

/*-------------------------------------------------------------------------------*/

קובץ main.c
int main(int argc, char *argv[]) - מקבל קבצים ושולח אותם לניתוח 
int AssemblyCompailer(char **filesList) - אחראי לניתוח הקובצים בהתאם למעברים : 
איתחול , פתיחת הקובץ .as , שליחה למעבר אשון , הכנה למעבר שני, שליחה למעבר שני, קריאה לכתיבה לקבצי פלט , סגירת קבצים ומחיקת לפי צורך , שיחרור זיכרון 
void SetOuputFilesName(char *file) - ניתוח שם הקובץ עבור קבצי הפלט

/*-------------------------------------------------------------------------------*/

קובץ header כללי המכיל הגדרות לכל התוכנית definitions.h 
ההגדרות:
bool , true , false - לציון ערכי 0 ו1 עם משמעות
opcode , func , AddresType - enums לציון הערכים של פרטי קוד הפקודה
מבני נתונים:
CMDWord- פרטי מילת הפקודה 
param - הפרמטרים של הפקודה
symbol - פרטי התוויות
instructionFields - פרטי קוד הפקודה
ו
/*--------------------------------------------------------------------------------*/
המעברים : השלד לפעולתם הוא האלגוריתם שסופק בחוברת הקורס 

מעבר ראשון בקובץ pass1.c  
לוקח שורה מהקובץ ובודק תקינות שורה 
בודק קיימות תווית ותקינותה
בודק סוג שורה - אם הנחייה -  אם .data או .string מוסיף את התווית לטבלת הסמלים עם הדגל המתאים , קורא לפונקציות המתאימות מdata.c להוספתם למערך הנתונים
אם .extern מוסיף לטבלת הסמלים עם הדגל המתאים 
אם .entry  מגדל (מעבר שני)
אם הוראה - בודק תקינות ומוסיף למערך הקוד בעזרת הפונקציות המתאימות ב code.c

מעבר שני בקובץ pass2.c 
מבנה זהה - ללא רוב בדיקות תקינות אלו נעשו במעבר הראשון
בחלק של שורות הנחייה , אם זה .entry מחפש את קיומה של התוית , בודק שאינה אקסטרנית .
בחלק ההוראה - ההוראה עצמה הוכנסה במעבר הראשון עם אופרנדים שהם מידי ואוגר , במעבר השני משלימים אופרנדים שהם תוויות - היחסי והישיר

/*---------------------------------------------------------------------------------*/

קובץ code - אחראי על משפטי ההוראה 
מגדיר מבנה נתונים instruction שמכיל את הקוד הבינארי וסוג איחסון והזיכרון 
מכיל את מערך תמונת הקוד ( מבני instruction)
מכיל מערך של מבנים של CMDWord שהוא רשימת כל מילות ההוראה המותרות בתוכנית 
משתמש במבנה הנתונים param symbol ו instructionFields

פעולות:
int IsRowEmpty(char* row) - האם השורה ריקה?
param GetOperands(char *str, int RC) - מקבלת את חלק הפרמטרים של שורת הוראה בודק את תקינותם(מספר אופרנדים, מספר פסיקים, מיקום פסיקים) טוען כל חלק למחרוזת במבנה הנתונים בנפרד ללא רווחים וללא פסיקים

CMDWord GetCMDName( char *commandName) - מזהה את מילת הפעולה ומחזיר את המבנה המתאים ברשימת הפעולות
int GetAddressing(char *operand, CMDWord cmd, int RC) - מקבל פרמטר ומזהה את שיטת המיעון

int makeOperand(char *Operand, AddresType type,  long IC, int RC) - מקבל פרמטר ומידע עליו בונה ממנו את הקוד הבינארי ומכניס למקום המתאים במערך תמונת הקוד
void makeInstruction(instructionFields inst_field, long IC) - מקבל פרטי מילה ראשונה בונה ממנה קוד בינארי ומכניס למקום התמאים במערך תמונת הקוד
void ResetCommand(instructionFields *machineCommand) - מאפס מבנה instruction

void WriteInstructionToFile(int firstAddress, int endAddress) - שולח את תאי תמונת הקוד לכתיבה בקובץ אובייקטים
/*---------------------------------------------------------------------------------*/

קובץ data - אחראי על שורות ההנחייה שמכניסות נתונים 
מכיל את מערך הנתונים data והמונה שלו  DC 
void WriteDataToFile(int fromAddress) - כותבת לקובץ העצמים
int saveDataToMem(char *str_num) - בודק תקינות נתונים מכניס למערך הנתונים ומקדם את המונה
int saveStringToMem(char *str) - בודק תקינות מחרוזת מכניס אותה למערך הנתונים תו תו ומקדם את המונה
int GetDC() ; void ResetDC() - לשימוש במונה
ו
/*---------------------------------------------------------------------------------*/

קובץ symbolTable - אחראי על טבלת הסמלים הוספת ומציאת התוויות ,
הטבלה מנוהלת כרשימה מקושרת , כל קודקוד ברשימה הוא מבנה נתונים node שמכיל שם אפיונים וכתובת תווית,ומצביע לקודקוד הבא
משתמש במבנה הנתונים symbol
הפעולות:
לשימוש הmain לפני ואחרי המעברים : 
void InitializeSymbolTable() - איתחול קודקוד ראשון ברשימה לקראת מעבר ראשון
void UpdateSymbolTable(int offset) - לעדכון הכתובות של התוויות בסוף המעבר הראשון לקראת המעבר השני
void FreeSymbolTable() - לשחרור הזכרון הדינאמי של הרשימה בסוף התוכנית 
לשימוש במעברים :
int InsertToSymbolTable(char *label, int addr, bool isCod, bool isDat, bool isEx) - מקבל תווית ותכונות ומכניס קודקוד חדש לרשימה
symbol* FindSymbol(char *label, bool check) - מחפש את התוית ברשימה ומחזיר אותה כסימבול לשימוש במערך העצמים
*הפרמרט check הוא לשימוש פנימי - כאשר מחפשים תוית, אם לא נמצאה , הפונקצייה מוציאה הודעת שגיאה. כאשר מכניסים תווית חדשה , הפוקצייה המכניסה משתמש בפונקצייה המחפשת כדי לבדוק שלא מכניסים תויות כפולה , אם התויות החדשה לא נמצאה אין זה שגיאה והפרמטר אחראי לא להוציא את הודעת השגיאה ולהמשיך את התוכנית.

/*----------------------------------------------------------------------------------*/

קובץ outputToFiles - אחראי על ניהול כל הקבצים 
מכיל מערך קבצים לניהולם 
הפעולות:
int LoadAssemblyFile() - יוצר פותח ומכין מהקובץ שהתקבל את קובץ .as 
int CloseAllOpenFiles() -סגירת הקבצים , קורא ל3 פונקציות  כל אחת סוגרת את אחד מ3 הקבצים שנוצרו
int DeleteAllFiles() - בהתגלות שגיאה מוחק את כל הקבצים שנוצרו 
int OpenObjectFile() ; int OpenEntryFile() ; int OpenExternalFile() - פותח קבצי פלט 
הפעולות שכותבות את הנתונים לקבצים:
void ExternalFileWriteLine(char *label , int address) 
void EntryFileWriteLine(char *label , int address)
void ObjectFileWriteLine(int address, int machineCode, int lt)
